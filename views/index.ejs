<%- include("header", {title: title}); %>

<body>
<nav>
    <div class="nav-wrapper teal darken-3">
        <div class="input-field">
            <input id="search" type="search" autocomplete="off">
            <label class="label-icon" for="search"><i class="material-icons">search</i></label>
            <i class="material-icons">close</i>
        </div>
    </div>
</nav>
<div class="row">
    <br>
    <div class="col s12">
        <a href="/" class="breadcrumb black-text">Home</a>
        <a href="/<%= path.root %>" class="breadcrumb black-text"><%= path.root %></a>
        <% for (const row of path.directories) {
            let directories = "";
            let index = path.directories.indexOf(row);
            if (index > 0) {
                directories = encodeURIComponent(path.directories.slice(0, index).toString()) + ",";
            }
        %>
            <a href="/<%= path.root %>?d=<%=`${directories}${encodeURIComponent(row)}`  %>" class="breadcrumb black-text"><%= row %></a>
        <% } %>

    </div>
</div>
<div class="container">
    <div class="collection">
        <% for (const row of res.directories) {
            let directoryPath = path.directories.length > 0 ? encodeURIComponent(path.directories.toString()) + "," : "";
        %>
            <a href="/<%= `${path.root}?d=${directoryPath}${encodeURIComponent(row.name)}` %>" class="collection-item"><%= row.name %></a>
        <% }%>

        <% for (const row of res.files) { %>
            <a href="static/<%= row.name %>" download class="collection-item light-blue-text "><%= row.name %></a>
        <% }%>
    </div>
</div>
<div class="row">
    <%
    let start = (page-1) * 24;
    let media = res.media.slice(start, start + 24);

    for (const row of media) {
        if (row.type === "image") {
    %>
        <div class="col s12 m2">
            <div class="card small hoverable scale-transition">
                <div class="container-image">
                    <div class="card-image">
                        <img class="materialboxed" data-caption="<%= row.name %>" src="static/<%= row.name %>">
                    </div>
                </div>
                <div class="card-content">
                    <p class="truncate"><%= row.name%></p>
                    <p class="truncate">Size: <%= row.size %></p>
                    <p class="truncate">Modified: <%= row.modified.toLocaleDateString() %></p>
                </div>
            </div>
        </div>
        <% } else if (row.type === "video") { %>
            <div class="col s12 m2">
                <div class="card small hoverable">
                    <div class="container-image">
                        <div class="card-image">
                            <video class="responsive-video" controls>
                                <source src="static/<%= row.name %>" type="video/mp4">
                            </video>
                        </div>
                    </div>
                    <div class="card-content">
                        <p class="truncate"><%= row.name%></p>
                        <p class="truncate">Size: <%= row.size %></p>
                        <p class="truncate">Modified: <%= row.modified.toLocaleDateString() %></p>
                    </div>
                </div>
            </div>
        <% } %>
    <% } %>
</div>

<ul class="pagination center">
    <% page = parseInt(page);
    
    if (page === 1) { %>
        <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
    <% } else { %>
        <li class="waves-effect"><a href="<%= `${path.root}?d=${encodeURIComponent(path.directories.toString())}&p=${page - 1}`%>"><i class="material-icons">chevron_left</i></a></li>
    <% } %>

    <% for (var i = 0; i < res.media.length / 24; i++) {
        let fullPath = `${path.root}?d=${encodeURIComponent(path.directories.toString())}&p=${i + 1}`;

        if (page == i + 1) { %>
            <li class="active teal"><a href="<%= fullPath %>"><%= i + 1 %></a></li>
       <% } else { %>
            <li class="waves-effect"><a href="<%= fullPath %>"><%= i + 1 %></a></li>
        <% } %>
    <% } %>

    <% if (page >= res.media.length / 24) { %>
            <li class="disabled"><a href="#!"><i class="material-icons">chevron_right</i></a></li>
    <% } else { %>
            <li class="waves-effect"><a href="<%= `${path.root}?d=${encodeURIComponent(path.directories.toString())}&p=${page + 1}`%>"><i class="material-icons">chevron_right</i></a></li>
    <% } %>
</ul>


<%- include("footer"); %>
</body>
<script src="/script/index.js"></script>
<script src="/script/search.js"></script>

